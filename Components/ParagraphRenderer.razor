@using SudaTales.Models
@using SudaTales.Services

@inject AnnotationRegistry Registry

<p class="paragraph">
    @Paragraph.Text

    @if (_annotations.Any())
    {
        <span class="annotation-indicator">
            (@_annotations.Count)
        </span>
    }
</p>

@code {
    [Parameter, EditorRequired]
    public Paragraph Paragraph { get; set; } = default!;

    [Parameter, EditorRequired]
    public string StorySlug { get; set; } = "";

    [Parameter, EditorRequired]
    public string ChapterId { get; set; } = "";

    private List<Annotation> _annotations = [];

    protected override void OnParametersSet()
    {
        _annotations = Registry
            .GetByChapter(StorySlug, ChapterId)
            .Where(a => a.Location.ParagraphId == Paragraph.Id)
            .ToList();
    }
}